function ChessBoard(){this.ChessPieceArray=[],this.ClapBoardArray=[[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]],this.player1=null,this.player2=null}function ClapBoard(t,e,a){this.x=t,this.y=e,this.state=a}function drawChessBoard(t){cxt.clearRect(0,0,canvas.width,canvas.width);for(var e=0;e<cells.length;e++){var a=cells[e];cxt.fillStyle="#242329",cxt.fillRect(a.x,a.y,a.w,a.h),a.obj==board.player1?(cxt.beginPath(),cxt.strokeStyle="#FFF",cxt.lineWidth=7,cxt.arc(a.x+a.w/2,a.y+a.h/2,a.w/2-5,0,2*Math.PI),cxt.closePath(),cxt.stroke(),cxt.fillStyle="#AE0000",cxt.fill()):a.obj==board.player2&&(cxt.beginPath(),cxt.strokeStyle="#FFF",cxt.lineWidth=7,cxt.arc(a.x+a.w/2,a.y+a.h/2,a.w/2-5,0,2*Math.PI),cxt.closePath(),cxt.stroke(),cxt.fillStyle="#0b1cc3",cxt.fill())}for(var r=0;r<clapboards.length;r++){var s=clapboards[r];cxt.fillStyle="#763f38",cxt.fillRect(s.x,s.y,s.w,s.h)}for(var o=0;o<clapboards.length;o++){var i=clapboards[o];0!=i.obj&&(cxt.fillStyle="#f2e47c",cxt.fillRect(i.x,i.y,i.w,i.h))}drawBorder(t)}function drawBorder(t){cxt.strokeStyle="rgb(13, 6, 45)",cxt.lineWidth=gap,cxt.beginPath(),cxt.lineTo(gap/2,gap/2),cxt.lineTo(t-gap/2,gap/2),cxt.lineTo(t-gap/2,t-gap/2),cxt.lineTo(gap/2,t-gap/2),cxt.closePath(),cxt.stroke()}function getCells(){for(;cells.length>0;)cells.pop();for(var t=0;t<board.ChessPieceArray.length;t++){var e=board.ChessPieceArray[t].x,a=board.ChessPieceArray[t].y,r=board.ChessPieceArray[t].object,s={i:e,j:a,x:gap+e*(gap+cell_width),y:gap+a*(gap+cell_width),w:cell_width,h:cell_width,obj:r};cells.push(s)}}function getClapBoards(){for(;clapboards.length>0;)clapboards.pop();for(var t=0;8>t;t++)for(var e=0;8>e;e++){var a=board.ClapBoardArray[t][e][0],r={i:t,j:e,x:gap+e*(gap+cell_width),y:gap+cell_width+t*(gap+cell_width),w:gap+2*cell_width,h:gap,state:0,obj:a};a=board.ClapBoardArray[t][e][1];var s={i:t,j:e,x:gap+cell_width+e*(gap+cell_width),y:gap+t*(gap+cell_width),w:gap,h:gap+2*cell_width,state:1,obj:a};clapboards.push(r),clapboards.push(s)}}function detectClick(t){var e=parseFloat(t.clientX)-parseFloat(canvas.getBoundingClientRect().left),a=parseFloat(t.clientY)-parseFloat(canvas.getBoundingClientRect().top),r=1==board.player1.turn?board.player1:board.player2,s=1==board.player1.turn?board.player2:board.player1;1!=handleCells(e,a,r,s)&&(handleClapboards(e,a,r,s),redLeft.innerHTML=board.player1.clapboardNum,blueLeft.innerHTML=board.player2.clapboardNum)}function handleCells(t,e,a,r){for(var s=!1,o=0;o<cells.length;o++){var i=cells[o];if(cxt.beginPath(),cxt.rect(i.x,i.y,i.w,i.h),cxt.isPointInPath(t,e)){s=!0;for(var l=0;l<a.valid_pos.length;l++){var n=a.valid_pos[l];if(n.x==i.i&&n.y==i.j)return a.moveToPos(n),a.turn=!1,r.turn=!0,r==board.player1?whoseTurn.innerHTML="Red":whoseTurn.innerHTML="Blue",getCells(),board.player1.getValidMovePositions(),board.player2.getValidMovePositions(),drawChessBoard(canvas.width),a.isWin()&&(a==board.player1?(alert("Red Wins"),prompt.innerHTML="Red Wins"):(alert("Blue Wins！"),prompt.innerHTML="Blue Wins！")),s}}}return s}function handleClapboards(t,e,a,r){for(var s=[],o=0;o<clapboards.length;o++){var i=clapboards[o];if(cxt.beginPath(),cxt.rect(i.x,i.y,i.w,i.h),cxt.isPointInPath(t,e)&&(s.push(i),s.length>=2))break}var l,n,h,c;if(1==s.length?n=0:2==s.length&&(n=1),0==s[n].obj){c=!0,h=0==s[n].state?1:0;var d=s[n].i,p=s[n].j;if(0==s[n].state?(p-1>=0&&0!=board.ClapBoardArray[d][p-1][s[n].state]&&(c=!1),8>p+1&&0!=board.ClapBoardArray[d][p+1][s[n].state]&&(c=!1)):1==s[n].state&&(d-1>=0&&0!=board.ClapBoardArray[d-1][p][s[n].state]&&(c=!1),8>d+1&&0!=board.ClapBoardArray[d+1][p][s[n].state]&&(c=!1)),0!=board.ClapBoardArray[d][p][h]&&(c=!1),console.log(c),1==c){if(a.clapboardNum<=0)return void(prompt.innerHTML="No Walls，Move pieces only。");a.putClapboard(d,p,s[n].state),a.turn=!1,r.turn=!0,r==board.player1?whoseTurn.innerHTML="Red":whoseTurn.innerHTML="Red",getCells(),l=new ClapBoard(d,p,s[n].state),board.ClapBoardArray[d][p][s[n].state]=l,getClapBoards(),board.player1.getValidMovePositions(),board.player2.getValidMovePositions(),drawChessBoard(canvas.width)}else prompt.innerHTML="Wall already present"}for(;s.length>0;)s.pop()}function detectHover(t){for(var e=parseFloat(t.clientX)-parseFloat(canvas.getBoundingClientRect().left),a=parseFloat(t.clientY)-parseFloat(canvas.getBoundingClientRect().top),r=[],s=0;s<clapboards.length;s++){var o=clapboards[s];if(cxt.beginPath(),cxt.rect(o.x,o.y,o.w,o.h),cxt.isPointInPath(e,a)&&(r.push(o),r.length>=2))break}var i=-1;1==r.length?i=0:2==r.length&&(i=1),-1!=i?(drawChessBoard(canvas.width),cxt.fillStyle="rgba(255, 255, 255, 1)",cxt.fillRect(r[i].x,r[i].y,r[i].w,r[i].h)):drawChessBoard(canvas.width)}function newGame(){board=new ChessBoard,board.init(),getCells(),getClapBoards(),board.player1.getValidMovePositions(),board.player2.getValidMovePositions(),redLeft.innerHTML=board.player1.clapboardNum,blueLeft.innerHTML=board.player2.clapboardNum,whoseTurn.innerHTML="Red",drawChessBoard(canvas.width)}function interaction(){$("a.rules.item").click(function(){$(".ui.modal.rules").modal("show")}),$("a.about.item").click(function(){$(".ui.modal.about").modal("show")}),$("#new-game").click(function(){newGame()})}function Player(t,e){this.init_pos=t,this.pos=t,this.valid_pos=[],this.clapboardNum=10,this.board=e,this.turn=!1}function Position(t,e){this.x=t,this.y=e,this.up=1,this.down=1,this.left=1,this.right=1,this.object=null,0>=t&&(this.left=0),this.x>=8&&(this.right=0),this.y<=0&&(this.up=0),this.y>=8&&(this.down=0)}const WIDTH=9,HEIGHT=9,CLAPBOARD_NUM=10;ChessBoard.prototype.init=function(){for(var t=0;HEIGHT>t;t++)for(var e=0;WIDTH>e;e++){var a=new Position(e,t);this.ChessPieceArray.push(a)}for(var r=0;8>r;r++)for(var s=0;8>s;s++)this.ClapBoardArray[r][s][0]=0,this.ClapBoardArray[r][s][1]=0;this.player1=new Player(new Position(4,0),this),this.player2=new Player(new Position(4,8),this),this.player1.turn=!0,this.ChessPieceArray[4].object=this.player1,this.ChessPieceArray[76].object=this.player2},ChessBoard.prototype.getPositionInDir=function(t,e){var a,r,s,o=t.x,i=t.y;switch(e){case 0:return a=o,r=i-1,s=WIDTH*r+a,s>=0&&81>s?this.ChessPieceArray[s]:!1;case 1:return a=o,r=i+1,s=WIDTH*r+a,s>=0&&81>s?this.ChessPieceArray[s]:!1;case 2:return a=o-1,r=i,s=WIDTH*r+a,s>=0&&81>s?this.ChessPieceArray[s]:!1;case 3:return a=o+1,r=i,s=WIDTH*r+a,s>=0&&81>s?this.ChessPieceArray[s]:!1;default:return!1}};var board,cells=[],clapboards=[],gap,cell_width,canvas,cxt,redLeft,blueLeft,whoseTurn,prompt;window.onload=function(){redLeft=document.getElementById("red-left"),blueLeft=document.getElementById("blue-left"),whoseTurn=document.getElementById("whose-turn"),prompt=document.getElementById("prompt-message");var t=document.getElementById("right-column"),e=parseInt(.6*t.offsetWidth);canvas=document.getElementById("canvas"),canvas.height=e,canvas.width=e,cxt=canvas.getContext("2d"),gap=canvas.width/37,cell_width=3*gap,newGame(),canvas.addEventListener("mouseup",detectClick),canvas.addEventListener("mousemove",detectHover),interaction()},Player.prototype.moveToPos=function(t){var e=this.pos.x,a=this.pos.y;this.pos=t,this.board.ChessPieceArray[e+a*WIDTH].object=null,this.board.ChessPieceArray[this.pos.x+this.pos.y*WIDTH].object=this},Player.prototype.putClapboard=function(t,e,a){var r=this.board.ChessPieceArray[t*WIDTH+e],s=this.board.ChessPieceArray[t*WIDTH+e+1],o=this.board.ChessPieceArray[(t+1)*WIDTH+e],i=this.board.ChessPieceArray[(t+1)*WIDTH+e+1];0==a?(r.down=0,s.down=0,o.up=0,i.up=0):1==a&&(r.right=0,s.left=0,o.right=0,i.left=0),this.clapboardNum--},Player.prototype.getValidMovePositions=function(){for(;this.valid_pos.length>0;)this.valid_pos.pop();var t,e;1==this.pos.up&&(t=this.board.ChessPieceArray[(this.pos.y-1)*WIDTH+this.pos.x],t.isValid()&&null==t.object&&this.valid_pos.push(t),null!=t.object&&(e=this.board.getPositionInDir(t,0),1==t.up&&this.valid_pos.push(e))),1==this.pos.down&&(t=this.board.ChessPieceArray[(this.pos.y+1)*WIDTH+this.pos.x],t.isValid()&&null==t.object&&this.valid_pos.push(t),null!=t.object&&(e=this.board.getPositionInDir(t,1),1==t.down&&this.valid_pos.push(e))),1==this.pos.left&&(t=this.board.ChessPieceArray[this.pos.y*WIDTH+this.pos.x-1],t.isValid()&&null==t.object&&this.valid_pos.push(t),null!=t.object&&(e=this.board.getPositionInDir(t,2),1==t.left&&this.valid_pos.push(e))),1==this.pos.right&&(t=this.board.ChessPieceArray[this.pos.y*WIDTH+this.pos.x+1],t.isValid()&&null==t.object&&this.valid_pos.push(t),null!=t.object&&(e=this.board.getPositionInDir(t,3),1==t.right&&this.valid_pos.push(e)))},Player.prototype.isWin=function(){if(0==this.init_pos.y){if(8==this.pos.y)return!0}else if(8==this.init_pos.y&&0==this.pos.y)return!0;return!1},Position.prototype.isValid=function(){return this.x>=0&&this.x<9&&this.y>=0&&this.y<9};